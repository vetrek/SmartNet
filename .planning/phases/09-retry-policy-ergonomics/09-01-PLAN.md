---
phase: 09-retry-policy-ergonomics
plan: 01
type: execute
---

<objective>
Improve retry policy API ergonomics by changing the default to no-retry and adding static factory methods.

Purpose: Make retry behavior explicit (opt-in rather than opt-out) and provide a cleaner, more discoverable API for creating retry policies.
Output: Updated RetryPolicy.swift with factory methods, updated NetworkConfiguration default, updated tests and documentation.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@Source/Core/RetryPolicy.swift
@Source/Core/NetworkConfiguration.swift

**Prior phase:** 08-in-code-documentation completed v2.0 milestone
**Patterns:** DocC documentation style established

**Current behavior:**
- Default retry policy: `ExponentialBackoffRetryPolicy()` (3 retries with exponential backoff)
- Users must explicitly set `NoRetryPolicy()` to disable retries
- Policies created via direct initializers

**Target behavior:**
- Default retry policy: `NoRetryPolicy()` (no retries - explicit opt-in)
- Static factory methods for all policies: `.exponential()`, `.linear()`, `.immediate()`, `.none`
- Backward compatible - existing direct initializers still work
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add static factory methods to RetryPolicy</name>
  <files>Source/Core/RetryPolicy.swift</files>
  <action>
Add a RetryPolicy extension with static factory methods that create policy instances:

```swift
public extension RetryPolicy where Self == ExponentialBackoffRetryPolicy {
    static func exponential(
        maxRetries: Int = 3,
        baseDelay: TimeInterval = 1.0,
        maxDelay: TimeInterval = 60.0,
        jitter: Bool = true,
        conditions: RetryCondition = .default
    ) -> ExponentialBackoffRetryPolicy
}
```

Similar pattern for:
- `.linear(maxRetries:delay:conditions:)` → LinearBackoffRetryPolicy
- `.immediate(maxRetries:conditions:)` → ImmediateRetryPolicy
- `.none` → NoRetryPolicy

Use protocol extensions with `where Self ==` constraints so methods appear on `any RetryPolicy` in autocomplete. Match existing init parameter defaults.

Add DocC comments matching the style in ApiClient+Combine.swift.
  </action>
  <verify>`swift build` succeeds with no errors</verify>
  <done>Four static factory methods exist on RetryPolicy: .exponential(), .linear(), .immediate(), .none</done>
</task>

<task type="auto">
  <name>Task 2: Change default retry policy to NoRetryPolicy</name>
  <files>Source/Core/NetworkConfiguration.swift</files>
  <action>
Change the default parameter value for `retryPolicy` in `NetworkConfiguration.init` from:
  `retryPolicy: RetryPolicy = ExponentialBackoffRetryPolicy()`
to:
  `retryPolicy: RetryPolicy = NoRetryPolicy()`

This is a behavioral change - requests will no longer retry by default. Users who want retries must explicitly configure them via:
- `NetworkConfiguration(baseURL: url, retryPolicy: .exponential())`
- Or per-endpoint via `Endpoint.retryPolicy`

Update the property's DocC comment to note the default is no-retry.
  </action>
  <verify>`swift build` succeeds, default is NoRetryPolicy in init signature</verify>
  <done>NetworkConfiguration default retry policy is NoRetryPolicy</done>
</task>

<task type="auto">
  <name>Task 3: Update tests and README</name>
  <files>Tests/UnitTests/RetryPolicyTests.swift, README.md</files>
  <action>
1. In RetryPolicyTests.swift, add tests for the new factory methods:
   - Test `.exponential()` creates ExponentialBackoffRetryPolicy with correct defaults
   - Test `.linear()` creates LinearBackoffRetryPolicy with correct defaults
   - Test `.immediate()` creates ImmediateRetryPolicy with correct defaults
   - Test `.none` creates NoRetryPolicy
   - Test factory methods with custom parameters

2. In README.md, update the Retry Policy section to:
   - Show factory method syntax as the primary way to configure retry
   - Note that default is no-retry (explicit opt-in)
   - Update any examples using direct initializers to use factory methods

Run `swift test` to verify all tests pass.
  </action>
  <verify>`swift test` passes all tests including new factory method tests</verify>
  <done>Factory method tests pass, README shows factory method usage</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `swift build` succeeds without errors
- [ ] `swift test` passes all tests
- [ ] Factory methods accessible via `RetryPolicy.exponential()` etc.
- [ ] NetworkConfiguration defaults to NoRetryPolicy
- [ ] README documents factory method usage
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No errors or warnings introduced
- Factory methods provide cleaner API for retry configuration
- Default behavior is no-retry (explicit opt-in for retries)
</success_criteria>

<output>
After completion, create `.planning/phases/09-retry-policy-ergonomics/09-01-SUMMARY.md`
</output>
