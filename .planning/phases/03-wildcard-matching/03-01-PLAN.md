---
phase: 03-wildcard-matching
plan: 01
type: execute
---

<objective>
Implement WildcardPathMatcher supporting single-segment wildcards.

Purpose: Enable middleware to match paths with dynamic segments like `/users/*` matching `/users/123` but not `/users/123/posts`.
Output: WildcardPathMatcher implementation with factory method and comprehensive tests.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase context:
@.planning/phases/01-path-matching-foundation/01-01-SUMMARY.md
@.planning/phases/02-exact-path-matching/02-01-SUMMARY.md

# Key files to modify:
@Source/Core/PathMatcher.swift
@Tests/UnitTests/PathMatcherTests.swift

**Established patterns:**
- PathMatcher protocol: matches(path:) -> Bool, pattern: String, Sendable conformance
- Factory methods via constrained protocol extension: PathMatcher.exact(_:), PathMatcher.contains(_:)
- Path normalization by stripping leading/trailing slashes
- Tests use Swift Testing framework (@Suite, @Test, #expect)
- MARK separators between matcher test sections
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create WildcardPathMatcher implementation</name>
  <files>Source/Core/PathMatcher.swift</files>
  <action>
Add WildcardPathMatcher struct after ExactPathMatcher:

1. Public struct conforming to PathMatcher protocol with pattern property
2. Matching logic:
   - Split both pattern and path by "/" to get segments
   - Strip empty segments from edges (handles leading/trailing slashes)
   - Pattern segments must equal path segments in count (single-segment wildcard only)
   - "*" segment matches any single path segment
   - Other segments must match exactly (case-sensitive)
3. Add docstring with examples showing:
   - `/users/*` matches `/users/123` but not `/users/123/posts`
   - `/api/*/details` matches `/api/users/details` and `/api/posts/details`
   - Multiple wildcards: `/*/items/*` matches `/users/items/123`
4. Add factory method in extension: `PathMatcher.wildcard(_:) -> WildcardPathMatcher`

WHY single-segment only: Phase 4 (GlobPathMatcher) handles multi-segment wildcards with `**`. This keeps each matcher focused and composable.
  </action>
  <verify>swift build compiles without errors</verify>
  <done>WildcardPathMatcher struct exists with matches(path:) implementation, factory method exists</done>
</task>

<task type="auto">
  <name>Task 2: Add WildcardPathMatcher unit tests</name>
  <files>Tests/UnitTests/PathMatcherTests.swift</files>
  <action>
Add test section after ExactPathMatcher tests with MARK separator:

1. `// MARK: - WildcardPathMatcher Tests`
2. Test cases to add:
   - Single trailing wildcard: `/users/*` matches `/users/123`, not `/users` or `/users/123/posts`
   - Middle wildcard: `/api/*/details` matches `/api/users/details`
   - Multiple wildcards: `/*/items/*` matches `/users/items/123`
   - Wildcard at start: `*/users` matches `api/users`
   - Just wildcard: `*` matches `anything` but not `a/b`
   - Leading/trailing slash normalization with wildcards
   - Case sensitivity of non-wildcard segments
   - Empty path handling (should not match)
   - Factory method creates correct matcher
   - Pattern property returns original pattern

Follow existing test style: @Test with descriptive string, func name matching test purpose, #expect for assertions.
  </action>
  <verify>swift test --filter PathMatcherTests runs and all tests pass</verify>
  <done>At least 10 WildcardPathMatcher test cases pass</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `swift build` succeeds without errors
- [ ] `swift test` passes all tests (including new WildcardPathMatcher tests)
- [ ] `/users/*` matches `/users/123` but not `/users/123/posts`
- [ ] No regressions in existing PathMatcher tests
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- WildcardPathMatcher correctly implements single-segment wildcard matching
- Factory method `PathMatcher.wildcard(_:)` available
- Comprehensive test coverage for wildcard matching scenarios
</success_criteria>

<output>
After completion, create `.planning/phases/03-wildcard-matching/03-01-SUMMARY.md` following frontmatter structure from prior summaries.
</output>
