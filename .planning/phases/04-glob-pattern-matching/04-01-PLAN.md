---
phase: 04-glob-pattern-matching
plan: 01
type: execute
---

<objective>
Implement GlobPathMatcher supporting multi-segment wildcards (`**`) that match zero or more path segments.

Purpose: Enable patterns like `/api/**` to match any depth of subpaths, completing the wildcard matching capabilities alongside single-segment `*` patterns.
Output: Working GlobPathMatcher struct with factory method and comprehensive test suite.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase context (dependency chain):
@.planning/phases/03-wildcard-matching/03-01-SUMMARY.md

# Key source files:
@Source/Core/PathMatcher.swift
@Tests/UnitTests/PathMatcherTests.swift

**Tech stack available:** Swift Testing framework, PathMatcher protocol
**Established patterns:**
- Segment-based matching with edge normalization
- Factory methods via constrained protocol extension
- Comprehensive doc comments with usage examples

**Constraining decisions:**
- Phase 03: Single-segment `*` matches exactly one segment; multi-segment `**` deferred to this phase
- Phase 01: PathMatcher protocol with `matches(path:)` and `pattern` property, Sendable conformance
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create GlobPathMatcher implementation</name>
  <files>Source/Core/PathMatcher.swift</files>
  <action>
Add GlobPathMatcher struct conforming to PathMatcher protocol after WildcardPathMatcher.

**Matching behavior:**
- `**` matches zero or more path segments (unlike `*` which matches exactly one)
- `/api/**` matches `/api`, `/api/v1`, `/api/v1/users/123`
- `/api/**/details` matches `/api/details`, `/api/v1/details`, `/api/v1/users/details`
- `**/users` matches `/users`, `/api/users`, `/api/v1/users`
- Support mixed `*` and `**`: `/api/*/v1/**` works correctly

**Implementation approach:**
- Split pattern and path into segments (reuse normalization pattern from WildcardPathMatcher)
- Use recursive or iterative matching algorithm to handle `**` consuming variable segments
- When encountering `**`, try matching remaining pattern against remaining path at each position
- `*` within pattern still matches exactly one segment
- Non-wildcard segments must match exactly (case-sensitive)

**What to avoid:**
- Do NOT use regex (defeats purpose of having dedicated matchers)
- Do NOT copy segments() helper - make it a shared private function or duplicate with same logic
- Do NOT allow `**` to match partial segments (it matches whole segments only)

**Also add:**
- Factory method `PathMatcher.glob(_:)` via protocol extension (same pattern as .wildcard, .exact, .contains)
- Comprehensive doc comments with usage examples matching existing style
  </action>
  <verify>swift build succeeds without errors or warnings</verify>
  <done>GlobPathMatcher struct exists with matches(path:) implementation, factory method available, builds cleanly</done>
</task>

<task type="auto">
  <name>Task 2: Add GlobPathMatcher unit tests</name>
  <files>Tests/UnitTests/PathMatcherTests.swift</files>
  <action>
Add test section `// MARK: - GlobPathMatcher Tests` after WildcardPathMatcher tests.

**Test cases to cover:**

1. **Trailing `**`:**
   - `/api/**` matches `/api`, `/api/v1`, `/api/v1/users`, `/api/v1/users/123`
   - `/api/**` does NOT match `/other`, `/apiv2`

2. **Middle `**`:**
   - `/api/**/details` matches `/api/details`, `/api/v1/details`, `/api/v1/users/details`
   - `/api/**/details` does NOT match `/api/v1/other`, `/other/details`

3. **Leading `**`:**
   - `**/users` matches `/users`, `/api/users`, `/api/v1/users`
   - `**/users` does NOT match `/users/123`, `/api/user`

4. **Multiple `**`:**
   - `/**/api/**` matches various combinations

5. **Mixed `*` and `**`:**
   - `/api/*/v1/**` - single wildcard then multi-segment
   - Verify `*` still requires exactly one segment

6. **Edge cases:**
   - `**` alone matches any path including empty
   - Empty pattern behavior
   - Slash normalization (leading/trailing)
   - Case sensitivity for literal segments

7. **Factory method:**
   - `PathMatcher.glob(_:)` creates correct matcher
   - Pattern property returns original pattern

**Follow existing test style:** `@Test("descriptive name")` with `#expect()` assertions.
  </action>
  <verify>swift test --filter PathMatcherTests passes all tests</verify>
  <done>12+ new test cases added, all tests pass including existing ContainsPathMatcher, ExactPathMatcher, and WildcardPathMatcher tests</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `swift build` succeeds without errors or warnings
- [ ] `swift test` passes all tests (existing + new)
- [ ] GlobPathMatcher handles all `**` patterns correctly
- [ ] Factory method `PathMatcher.glob(_:)` works
</verification>

<success_criteria>

- GlobPathMatcher struct implemented with `**` multi-segment matching
- Factory method `PathMatcher.glob(_:)` available
- 12+ unit tests covering all glob patterns
- All 260+ tests pass (no regressions)
- Code follows established patterns from prior matchers
</success_criteria>

<output>
After completion, create `.planning/phases/04-glob-pattern-matching/04-01-SUMMARY.md` following summary template with:
- Frontmatter (phase, plan, subsystem, requires, provides, affects, tech-stack, key-files, key-decisions, duration)
- Performance metrics
- Accomplishments
- Task commits
- Files modified
- Decisions made
- Next phase readiness (Phase 5: Regex Path Matching)
</output>
